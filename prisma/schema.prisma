generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")

  // â±ï¸ ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ SQLite Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ transactions Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
  relationMode = "prisma"
}

model Member {
  id                String       @id @default(cuid())
  memberNumber      Int?         @unique
  name              String
  phone             String       // Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙŠ Ø§Ù„Ù€ API Ù„Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¬ÙØ¯Ø¯
  backupPhone       String?
  nationalId        String?
  birthDate         DateTime?
  source            String?
  profileImage      String?
  idCardFront       String?
  idCardBack        String?
  inBodyScans       Int          @default(0)
  invitations       Int          @default(0)
  freePTSessions    Int          @default(0)
  freeNutritionSessions   Int    @default(0)
  freePhysioSessions      Int    @default(0)
  freeGroupClassSessions  Int    @default(0)
  remainingFreezeDays Int        @default(0)
  subscriptionPrice Float
  remainingAmount   Float        @default(0)
  points            Int          @default(0)
  notes             String?
  isActive          Boolean      @default(true)
  isFrozen          Boolean      @default(false)
  startDate         DateTime?
  expiryDate        DateTime?
  coachId           String?
  createdAt         DateTime     @default(now())
  invitationRecords    Invitation[]
  receipts             Receipt[]
  checkIns             MemberCheckIn[]
  fitnessTest          FitnessTest?
  fitnessTestRequests  FitnessTestRequest[]
  spaBookings          SpaBooking[]
  freezeRequests       FreezeRequest[]
  pointsHistory        PointsHistory[]
  coach                Staff?       @relation("CoachMembers", fields: [coachId], references: [id], onDelete: SetNull)

  @@index([coachId])
}

model MemberCheckIn {
  id                    String    @id @default(cuid())
  memberId              String
  checkInTime           DateTime  @default(now())
  checkInMethod         String    @default("scan")

  member                Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([checkInTime])
}

model PT {
  ptNumber          Int         @id @default(autoincrement())
  clientName        String
  phone             String
  sessionsPurchased Int
  sessionsRemaining Int
  coachName         String
  pricePerSession   Float
  startDate         DateTime?
  expiryDate        DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  coachUserId       String?
  qrCode            String?     @unique
  qrCodeImage       String?
  remainingAmount   Int?
  sessions          PTSession[]
  receipts          Receipt[]

  @@index([coachUserId])
  @@index([qrCode])
}

model PTSession {
  id          String    @id @default(cuid())
  ptNumber    Int
  clientName  String
  coachName   String
  sessionDate DateTime
  notes       String?
  createdAt   DateTime  @default(now())
  attended    Boolean   @default(false)
  attendedAt  DateTime?
  attendedBy  String?
  pt          PT        @relation(fields: [ptNumber], references: [ptNumber], onDelete: Cascade)

  @@index([ptNumber])
  @@index([sessionDate])
  @@index([attended])
}

model DayUseInBody {
  id          String    @id @default(cuid())
  name        String
  phone       String
  serviceType String
  price       Float
  staffName   String
  createdAt   DateTime  @default(now())
  receipts    Receipt[]
}

model Visitor {
  id           String     @id @default(cuid())
  name         String
  phone        String     @unique
  notes        String?
  source       String     @default("walk-in")
  interestedIn String?
  status       String     @default("pending")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  followUps    FollowUp[]

  @@index([status])
  @@index([createdAt])
  @@index([phone])
}

model FollowUp {
  id               String    @id @default(cuid())
  visitorId        String
  notes            String
  contacted        Boolean   @default(false)
  nextFollowUpDate DateTime?
  result           String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  salesName        String?

  // New fields for enhanced tracking
  assignedTo       String?      // Staff ID assigned to this followup
  priority         String?      // 'high', 'medium', 'low'
  stage            String       @default("new") // Pipeline stage
  lastContactedAt  DateTime?    // Last contact timestamp
  contactCount     Int          @default(0)   // Number of contact attempts
  archived         Boolean      @default(false) // Soft delete for converted
  archivedAt       DateTime?    // When archived
  archivedReason   String?      // Why archived ('converted', 'renewed', 'manual')

  visitor          Visitor   @relation(fields: [visitorId], references: [id], onDelete: Cascade)
  assignedStaff    Staff?    @relation("FollowUpAssignments", fields: [assignedTo], references: [id], onDelete: SetNull)
  activities       FollowUpActivity[]

  @@index([visitorId])
  @@index([nextFollowUpDate])
  @@index([contacted])
  @@index([assignedTo])
  @@index([stage])
  @@index([archived])
}

model Receipt {
  id            String        @id @default(cuid())
  receiptNumber Int           @unique
  type          String
  amount        Float
  itemDetails   String
  paymentMethod String        @default("cash")
  createdAt     DateTime      @default(now())
  staffName     String?
  memberId      String?
  ptNumber      Int?
  dayUseId      String?
  nutritionNumber    Int?
  physioNumber       Int?
  classNumber        Int?
  isCancelled   Boolean       @default(false)
  cancelledAt   DateTime?
  cancelledBy   String?
  cancelReason  String?
  dayUse        DayUseInBody? @relation(fields: [dayUseId], references: [id])
  pt            PT?           @relation(fields: [ptNumber], references: [ptNumber])
  member        Member?       @relation(fields: [memberId], references: [id])
  nutrition     Nutrition?    @relation(fields: [nutritionNumber], references: [nutritionNumber])
  physiotherapy Physiotherapy? @relation(fields: [physioNumber], references: [physioNumber])
  groupClass    GroupClass?   @relation(fields: [classNumber], references: [classNumber])
}

model ReceiptCounter {
  id      Int @id @default(autoincrement())
  current Int @default(1000)
}

model MemberCounter {
  id      Int @id @default(autoincrement())
  current Int @default(1000)
}

model Offer {
  id                      String   @id @default(cuid())
  name                    String
  duration                Int
  price                   Float
  freePTSessions          Int      @default(0)
  freeNutritionSessions   Int      @default(0)
  freePhysioSessions      Int      @default(0)
  freeGroupClassSessions  Int      @default(0)
  nutritionPrice          Float?   @default(0)
  physioPrice             Float?   @default(0)
  groupClassPrice         Float?   @default(0)
  inBodyScans             Int      @default(0)
  invitations             Int      @default(0)
  freezeDays              Int      @default(0)
  icon                    String   @default("ğŸ“…")
  isActive                Boolean  @default(true)
  upgradeEligibilityDays  Int?     @default(7)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model Staff {
  id           String         @id @default(cuid())
  staffCode    String         @unique
  name         String
  phone        String?
  position     String?
  salary       Float?
  notes        String?
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  attendance          Attendance[]
  expenses            Expense[]
  user                User?
  fitnessTests        FitnessTest[]
  fitnessTestRequests FitnessTestRequest[] @relation("FitnessTestRequests")
  rotations           Rotation[]
  commissions         Commission[]
  members             Member[]       @relation("CoachMembers")
  followUpAssignments FollowUp[]     @relation("FollowUpAssignments")
  followUpActivities  FollowUpActivity[]

  @@index([staffCode])
}

model Attendance {
  id        String    @id @default(cuid())
  staffId   String
  checkIn   DateTime
  checkOut  DateTime?
  duration  Int?
  notes     String?
  createdAt DateTime  @default(now())
  staff     Staff     @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([checkIn])
}

model Expense {
  id          String   @id @default(cuid())
  type        String
  amount      Float
  description String
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  staffId     String?
  isPaid      Boolean  @default(false)
  staff       Staff?   @relation(fields: [staffId], references: [id])
}

model Commission {
  id          String   @id @default(cuid())
  staffId     String
  memberId    String?
  amount      Float
  type        String
  description String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  staff       Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([type])
  @@index([createdAt])
}

model Invitation {
  id         String   @id @default(cuid())
  guestName  String
  guestPhone String
  notes      String?
  createdAt  DateTime @default(now())
  memberId   String
  member     Member   @relation(fields: [memberId], references: [id])
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  name         String
  password     String
  role         String        @default("STAFF")
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  staffId      String?       @unique
  activityLogs ActivityLog[]
  permissions  Permission?
  spaBookings  SpaBooking[]
  staff        Staff?        @relation(fields: [staffId], references: [id])
}

model Permission {
  id                      String  @id @default(cuid())
  userId                  String  @unique
  canViewMembers          Boolean @default(false)
  canCreateMembers        Boolean @default(false)
  canEditMembers          Boolean @default(false)
  canDeleteMembers        Boolean @default(false)
  canViewPT               Boolean @default(false)
  canCreatePT             Boolean @default(false)
  canEditPT               Boolean @default(false)
  canDeletePT             Boolean @default(false)
  canRegisterPTAttendance Boolean @default(false)
  canViewNutrition        Boolean @default(false)
  canCreateNutrition      Boolean @default(false)
  canEditNutrition        Boolean @default(false)
  canDeleteNutrition      Boolean @default(false)
  canRegisterNutritionAttendance Boolean @default(false)
  canViewPhysiotherapy    Boolean @default(false)
  canCreatePhysiotherapy  Boolean @default(false)
  canEditPhysiotherapy    Boolean @default(false)
  canDeletePhysiotherapy  Boolean @default(false)
  canRegisterPhysioAttendance Boolean @default(false)
  canViewGroupClass       Boolean @default(false)
  canCreateGroupClass     Boolean @default(false)
  canEditGroupClass       Boolean @default(false)
  canDeleteGroupClass     Boolean @default(false)
  canRegisterClassAttendance Boolean @default(false)
  canViewStaff            Boolean @default(false)
  canCreateStaff          Boolean @default(false)
  canEditStaff            Boolean @default(false)
  canDeleteStaff          Boolean @default(false)
  canViewReceipts         Boolean @default(false)
  canEditReceipts         Boolean @default(false)
  canDeleteReceipts       Boolean @default(false)
  canViewExpenses         Boolean @default(false)
  canCreateExpense        Boolean @default(false)
  canEditExpense          Boolean @default(false)
  canDeleteExpense        Boolean @default(false)
  canViewVisitors         Boolean @default(false)
  canCreateVisitor        Boolean @default(false)
  canEditVisitor          Boolean @default(false)
  canDeleteVisitor        Boolean @default(false)
  canViewFollowUps        Boolean @default(false)
  canCreateFollowUp       Boolean @default(false)
  canEditFollowUp         Boolean @default(false)
  canDeleteFollowUp       Boolean @default(false)
  canViewDayUse           Boolean @default(false)
  canCreateDayUse         Boolean @default(false)
  canEditDayUse           Boolean @default(false)
  canDeleteDayUse         Boolean @default(false)
  canViewReports          Boolean @default(false)
  canViewFinancials       Boolean @default(false)
  canViewAttendance       Boolean @default(false)
  canAccessClosing        Boolean @default(false)
  canAccessSettings       Boolean @default(false)
  canAccessAdmin          Boolean @default(false)
  canCreateFitnessTest    Boolean @default(false)
  canViewFitnessTests     Boolean @default(false)
  canViewSpaBookings      Boolean @default(false)
  canCreateSpaBooking     Boolean @default(false)
  canEditSpaBooking       Boolean @default(false)
  canCancelSpaBooking     Boolean @default(false)
  canViewSpaReports       Boolean @default(false)
  user                    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ActivityLog {
  id         String   @id @default(cuid())
  userId     String
  action     String
  resource   String
  resourceId String?
  details    String?
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model FitnessTest {
  id                String    @id @default(cuid())
  memberId          String    @unique
  coachId           String
  coachUserId       String
  testDate          DateTime

  medFirstTimeGym              Boolean   @default(false)
  medInDietPlan                Boolean   @default(false)
  medHernia                    Boolean   @default(false)
  medFamilyHeartHistory        Boolean   @default(false)
  medHeartProblem              Boolean   @default(false)
  medBackPain                  Boolean   @default(false)
  medSurgery                   Boolean   @default(false)
  medBreathingProblems         Boolean   @default(false)
  medBloodPressure             Boolean   @default(false)
  medKneeProblem               Boolean   @default(false)
  medDiabetes                  Boolean   @default(false)
  medSmoker                    Boolean   @default(false)
  medHighCholesterol           Boolean   @default(false)

  flexibilityData  String
  exerciseData     String

  createdAt        DateTime  @default(now())
  createdBy        String

  member           Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  coach            Staff     @relation(fields: [coachId], references: [id])

  @@index([memberId])
  @@index([coachUserId])
}

model FitnessTestRequest {
  id           String   @id @default(cuid())
  memberId     String
  coachId      String
  status       String   @default("pending") // pending, completed, cancelled
  requestedBy  String
  requestedAt  DateTime @default(now())
  completedAt  DateTime?
  notes        String?

  member       Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  coach        Staff    @relation("FitnessTestRequests", fields: [coachId], references: [id])

  @@index([coachId])
  @@index([status])
  @@index([memberId])
}

model Rotation {
  id          String   @id @default(cuid())
  staffId     String
  dayOfWeek   String   // Monday, Tuesday, etc.
  startTime   String   // "09:00"
  endTime     String   // "17:00"
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  staff       Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([dayOfWeek])
}

model FollowUpActivity {
  id           String    @id @default(cuid())
  followUpId   String
  activityType String    // 'call', 'whatsapp', 'visit', 'note', 'stage_change', 'assignment'
  notes        String?
  createdBy    String
  createdAt    DateTime  @default(now())

  followUp     FollowUp  @relation(fields: [followUpId], references: [id], onDelete: Cascade)
  staff        Staff     @relation(fields: [createdBy], references: [id])

  @@index([followUpId])
  @@index([createdAt])
}

model LicenseValidation {
  id            String   @id @default("singleton")
  isValid       Boolean  @default(true)
  lastCheckedAt DateTime @default(now())
  errorMessage  String?
  signature     String?
}

// ğŸ”’ Audit Logging System
model AuditLog {
  id           String   @id @default(cuid())
  userId       String?
  userEmail    String?
  userName     String?
  userRole     String?
  action       String   // LOGIN, LOGOUT, CREATE, UPDATE, DELETE, ACCESS_DENIED, etc.
  resource     String   // Member, Staff, Receipt, User, etc.
  resourceId   String?
  details      String?  // JSON string with additional details
  ipAddress    String?
  userAgent    String?
  status       String   @default("success") // success, failure, warning
  errorMessage String?
  createdAt    DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([status])
  @@index([createdAt])
}

// ğŸŸ¢ Active Sessions Tracking
model ActiveSession {
  id            String   @id @default(cuid())
  userId        String
  userEmail     String
  userName      String
  userRole      String
  loginAt       DateTime @default(now())
  lastActivityAt DateTime @default(now())
  ipAddress     String?
  userAgent     String?
  isActive      Boolean  @default(true)

  @@index([userId])
  @@index([isActive])
  @@index([loginAt])
  @@index([lastActivityAt])
}

// ğŸ’† SPA Booking System
model SpaBooking {
  id              String    @id @default(cuid())

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ
  memberId        String
  memberName      String
  memberPhone     String?

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø²
  serviceType     String    // 'massage', 'sauna', 'jacuzzi'
  bookingDate     DateTime  // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²
  bookingTime     String    // ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡ "10:00"
  duration        Int       // Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ (30, 60, 90)

  // Ø§Ù„Ø­Ø§Ù„Ø©
  status          String    @default("pending")  // pending, confirmed, completed, cancelled

  // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  notes           String?

  // Ù…Ù† Ù‚Ø§Ù… Ø¨Ø§Ù„Ø­Ø¬Ø²
  createdBy       String    // Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù/Ø§Ù„Ù…Ø¯ÙŠØ±
  createdByUserId String?   // ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

  // Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  member          Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  user            User?     @relation(fields: [createdByUserId], references: [id], onDelete: SetNull)

  @@index([memberId])
  @@index([bookingDate])
  @@index([status])
  @@index([serviceType])
}

model FreezeRequest {
  id          String    @id @default(cuid())
  memberId    String

  // ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¬Ù…ÙŠØ¯
  startDate   DateTime  // ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¯
  endDate     DateTime  // ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¯
  days        Int       // Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¬Ù…ÙŠØ¯

  // Ø§Ù„Ø³Ø¨Ø¨
  reason      String?

  // Ø§Ù„Ø­Ø§Ù„Ø©
  status      String    @default("pending")  // pending, approved, rejected

  // Ù…Ù† ÙˆØ§ÙÙ‚/Ø±ÙØ¶
  approvedBy  String?   // Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù/Ø§Ù„Ù…Ø¯ÙŠØ±
  approvedAt  DateTime?

  // Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  member      Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([status])
  @@index([startDate])
}

model CommissionSettings {
  id          String   @id @default(cuid())
  // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ
  tier1Limit  Float    @default(5000)   // Ø£Ù‚Ù„ Ù…Ù† 5000
  tier2Limit  Float    @default(11000)  // 5000-10999
  tier3Limit  Float    @default(15000)  // 11000-14999
  tier4Limit  Float    @default(20000)  // 15000-19999
  // Ø§Ù„Ù†Ø³Ø¨ Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰
  tier1Rate   Float    @default(25)     // 25%
  tier2Rate   Float    @default(30)     // 30%
  tier3Rate   Float    @default(35)     // 35%
  tier4Rate   Float    @default(40)     // 40%
  tier5Rate   Float    @default(45)     // 45%
  // ØªÙˆØ§Ø±ÙŠØ®
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ===== Ø§Ù„ØªØºØ°ÙŠØ© (Nutrition) =====
model Nutrition {
  nutritionNumber   Int         @id @default(autoincrement())
  clientName        String
  phone             String
  memberNumber      Int?        // Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© (Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·)
  sessionsPurchased Int
  sessionsRemaining Int
  nutritionistName  String
  pricePerSession   Float
  startDate         DateTime?
  expiryDate        DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  coachUserId       String?
  qrCode            String?     @unique
  qrCodeImage       String?
  remainingAmount   Int?
  sessions          NutritionSession[]
  receipts          Receipt[]

  @@index([coachUserId])
  @@index([qrCode])
  @@index([memberNumber])
}

model NutritionSession {
  id              String      @id @default(cuid())
  nutritionNumber Int
  clientName      String
  nutritionistName String
  sessionDate     DateTime
  notes           String?
  createdAt       DateTime    @default(now())
  attended        Boolean     @default(false)
  attendedAt      DateTime?
  attendedBy      String?
  nutrition       Nutrition   @relation(fields: [nutritionNumber], references: [nutritionNumber], onDelete: Cascade)

  @@index([nutritionNumber])
  @@index([sessionDate])
  @@index([attended])
}

// ===== Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ (Physiotherapy) =====
model Physiotherapy {
  physioNumber      Int         @id @default(autoincrement())
  clientName        String
  phone             String
  memberNumber      Int?        // Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© (Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·)
  sessionsPurchased Int
  sessionsRemaining Int
  therapistName     String
  pricePerSession   Float
  startDate         DateTime?
  expiryDate        DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  therapistUserId   String?
  qrCode            String?     @unique
  qrCodeImage       String?
  remainingAmount   Int?
  sessions          PhysiotherapySession[]
  receipts          Receipt[]

  @@index([therapistUserId])
  @@index([qrCode])
  @@index([memberNumber])
}

model PhysiotherapySession {
  id            String         @id @default(cuid())
  physioNumber  Int
  clientName    String
  therapistName String
  sessionDate   DateTime
  notes         String?
  createdAt     DateTime       @default(now())
  attended      Boolean        @default(false)
  attendedAt    DateTime?
  attendedBy    String?
  physiotherapy Physiotherapy  @relation(fields: [physioNumber], references: [physioNumber], onDelete: Cascade)

  @@index([physioNumber])
  @@index([sessionDate])
  @@index([attended])
}

// ===== Ø¬Ø±ÙˆØ¨ ÙƒÙ„Ø§Ø³ÙŠØ³ (Group Classes) =====
model GroupClass {
  classNumber       Int         @id @default(autoincrement())
  clientName        String
  phone             String
  memberNumber      Int?        // Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© (Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·)
  sessionsPurchased Int
  sessionsRemaining Int
  instructorName    String
  pricePerSession   Float
  startDate         DateTime?
  expiryDate        DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  instructorUserId  String?
  qrCode            String?     @unique
  qrCodeImage       String?
  remainingAmount   Int?
  sessions          GroupClassSession[]
  receipts          Receipt[]

  @@index([instructorUserId])
  @@index([qrCode])
  @@index([memberNumber])
}

model GroupClassSession {
  id             String      @id @default(cuid())
  classNumber    Int
  clientName     String
  instructorName String
  sessionDate    DateTime
  notes          String?
  createdAt      DateTime    @default(now())
  attended       Boolean     @default(false)
  attendedAt     DateTime?
  attendedBy     String?
  groupClass     GroupClass  @relation(fields: [classNumber], references: [classNumber], onDelete: Cascade)

  @@index([classNumber])
  @@index([sessionDate])
  @@index([attended])
}

// Ù†Ø¸Ø§Ù… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª
model SystemSettings {
  id                    String   @id @default("singleton")
  nutritionEnabled      Boolean  @default(true)
  physiotherapyEnabled  Boolean  @default(true)
  groupClassEnabled     Boolean  @default(true)
  spaEnabled            Boolean  @default(true)
  inBodyEnabled         Boolean  @default(true)
  pointsEnabled         Boolean  @default(true)
  pointsPerCheckIn      Int      @default(1)
  pointsPerInvitation   Int      @default(2)
  pointsPerEGPSpent     Float    @default(0.1)  // Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø¬Ù†ÙŠÙ‡ ÙŠØªÙ… Ø¯ÙØ¹Ù‡
  pointsValueInEGP      Float    @default(0.1)
  websiteUrl            String?  @default("https://www.xgym.website")  // Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
  showWebsiteOnReceipts Boolean  @default(false)  // Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª
  updatedAt             DateTime @updatedAt
  updatedBy             String?
}

// Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª
model ServicePackage {
  id          String   @id @default(cuid())
  name        String
  serviceType String   // 'PT', 'Nutrition', 'Physiotherapy', 'GroupClass'
  sessions    Int
  price       Float
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([serviceType])
  @@index([isActive])
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· - ØªØ§Ø±ÙŠØ® Ø§ÙƒØªØ³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
model PointsHistory {
  id          String   @id @default(cuid())
  memberId    String
  points      Int      // Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©
  action      String   // Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·: 'check-in', 'invitation'
  description String?  // ÙˆØµÙ Ø§Ø®ØªÙŠØ§Ø±ÙŠ
  createdAt   DateTime @default(now())

  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([createdAt])
  @@index([action])
}
