# ุฏููู ุชุญุฏูุซ ุงููุธุงู ุฎุทูุฉ ุจุฎุทูุฉ ๐

## ูุจู ุงูุชุญุฏูุซ - Pre-Update โ๏ธ

### 1. ูุณุฎ ุงุญุชูุงุทู ูููุงุนุฏุฉ (ููู ุฌุฏุงู!)
```bash
# ุงูุชูู ููุฌูุฏ ุงููุธุงู
cd "C:\Users\amran\Desktop\x gym"

# ุงูุณุฎ ูุงุนุฏุฉ ุงูุจูุงูุงุช
copy prisma\gym.db prisma\gym-backup-%date:~-4,4%%date:~-10,2%%date:~-7,2%.db

# ุชุฃูุฏ ูู ูุฌุงุญ ุงููุณุฎ
dir prisma\gym-backup-*.db
```

### 2. ุชุญูู ูู ุญุงูุฉ ุงููุธุงู ุงูุญุงูู
```bash
# ุชุญูู ูู ุญุงูุฉ ุงูุชุทุจููุงุช
pm2 status

# ุชุญูู ูู ุงูููุงูุฐ
netstat -ano | findstr "4001 3002"
```

---

## ุงูุชุญุฏูุซ - Update Process ๐

### ุงูุทุฑููุฉ 1: ุชุญุฏูุซ ูุฏูู (Manual Update)

#### ุฎุทูุฉ 1: ุฅููุงู ุงูุชุทุจููุงุช
```bash
# ุฅููุงู ุงููุธุงู ุงูุฑุฆูุณู
pm2 stop xgym-system

# ุฅููุงู ุจูุงุจุฉ ุงูุนููุงุก
pm2 stop xgym-client
```

#### ุฎุทูุฉ 2: ุชุญุฏูุซ ุงูููุฏ
```bash
# ุฅุฐุง ููุช ุชุณุชุฎุฏู Git
cd "C:\Users\amran\Desktop\x gym"
git pull origin main

# ุฃู ุงูุณุฎ ุงููููุงุช ุงูุฌุฏูุฏุฉ ูุฏููุงู
```

#### ุฎุทูุฉ 3: ุชุญุฏูุซ ุงูููุชุจุงุช (ุฅุฐุง ูุฒู ุงูุฃูุฑ)
```bash
# ุงููุธุงู ุงูุฑุฆูุณู
cd "C:\Users\amran\Desktop\x gym"
npm install

# ุจูุงุจุฉ ุงูุนููุงุก
cd "C:\Users\amran\Desktop\x gym\client-portal"
npm install
```

#### ุฎุทูุฉ 4: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุฅุฐุง ูุงู ููุงู ุชุบููุฑุงุช ูู Schema)
```bash
cd "C:\Users\amran\Desktop\x gym"
npx prisma generate
npx prisma migrate deploy
```

#### ุฎุทูุฉ 5: ุจูุงุก ุงูุชุทุจููุงุช
```bash
# ุงููุธุงู ุงูุฑุฆูุณู
cd "C:\Users\amran\Desktop\x gym"
npm run build

# ุจูุงุจุฉ ุงูุนููุงุก
cd "C:\Users\amran\Desktop\x gym\client-portal"
npm run build
```

#### ุฎุทูุฉ 6: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจููุงุช
```bash
# ุชุดุบูู ุงููุธุงู ุงูุฑุฆูุณู
pm2 restart xgym-system

# ุชุดุบูู ุจูุงุจุฉ ุงูุนููุงุก
pm2 restart xgym-client

# ุงูุชุญูู ูู ุงูุญุงูุฉ
pm2 status
```

---

### ุงูุทุฑููุฉ 2: ุณูุฑูุจุช ุชุญุฏูุซ ุชููุงุฆู (Automated Script)

ุงุญูุธ ูุฐุง ูู ููู `update.bat`:

```batch
@echo off
echo ========================================
echo ุชุญุฏูุซ ูุธุงู X Gym
echo ========================================
echo.

REM ุงููุณุฎ ุงูุงุญุชูุงุทู
echo [1/7] ุฌุงุฑู ุงููุณุฎ ุงูุงุญุชูุงุทู...
cd "C:\Users\amran\Desktop\x gym"
copy prisma\gym.db prisma\gym-backup-%date:~-4,4%%date:~-10,2%%date:~-7,2%.db
echo โ ุชู ุงููุณุฎ ุงูุงุญุชูุงุทู

REM ุฅููุงู ุงูุชุทุจููุงุช
echo.
echo [2/7] ุฌุงุฑู ุฅููุงู ุงูุชุทุจููุงุช...
pm2 stop xgym-system
pm2 stop xgym-client
echo โ ุชู ุฅููุงู ุงูุชุทุจููุงุช

REM ุชุญุฏูุซ ุงูููุชุจุงุช
echo.
echo [3/7] ุฌุงุฑู ุชุญุฏูุซ ุงูููุชุจุงุช...
cd "C:\Users\amran\Desktop\x gym"
call npm install
cd client-portal
call npm install
cd ..
echo โ ุชู ุชุญุฏูุซ ุงูููุชุจุงุช

REM ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo.
echo [4/7] ุฌุงุฑู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช...
call npx prisma generate
call npx prisma migrate deploy
echo โ ุชู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

REM ุจูุงุก ุงููุธุงู ุงูุฑุฆูุณู
echo.
echo [5/7] ุฌุงุฑู ุจูุงุก ุงููุธุงู ุงูุฑุฆูุณู...
call npm run build
echo โ ุชู ุจูุงุก ุงููุธุงู ุงูุฑุฆูุณู

REM ุจูุงุก ุจูุงุจุฉ ุงูุนููุงุก
echo.
echo [6/7] ุฌุงุฑู ุจูุงุก ุจูุงุจุฉ ุงูุนููุงุก...
cd client-portal
call npm run build
cd ..
echo โ ุชู ุจูุงุก ุจูุงุจุฉ ุงูุนููุงุก

REM ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจููุงุช
echo.
echo [7/7] ุฌุงุฑู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจููุงุช...
pm2 restart xgym-system
pm2 restart xgym-client
echo โ ุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจููุงุช

echo.
echo ========================================
echo โ ุงูุชูู ุงูุชุญุฏูุซ ุจูุฌุงุญ!
echo ========================================
echo.

REM ุนุฑุถ ุงูุญุงูุฉ
pm2 status

pause
```

ูุงุณุชุฎุฏุงู ุงูุณูุฑูุจุช:
```bash
# ููุท ุดุบู ุงูููู
update.bat
```

---

## ุงูุชุญูู ูู ุงูุชุญุฏูุซ - Verification โ

### 1. ุชุญูู ูู ุญุงูุฉ ุงูุชุทุจููุงุช
```bash
pm2 status
```
ูุฌุจ ุฃู ุชููู ุญุงูุฉ ุงูุชุทุจููุงุช: **online** โ

### 2. ุชุญูู ูู ุงูู logs
```bash
# logs ุงููุธุงู ุงูุฑุฆูุณู
pm2 logs xgym-system --lines 50

# logs ุจูุงุจุฉ ุงูุนููุงุก
pm2 logs xgym-client --lines 50
```
ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก โ

### 3. ุงุฎุชุจุฑ ุงูุฑูุงุจุท
ุงูุชุญ ูู ุงููุชุตูุญ:
- โ http://system.xgym.website (ุงููุธุงู ุงูุฑุฆูุณู)
- โ http://client.xgym.website (ุจูุงุจุฉ ุงูุนููุงุก)

### 4. ุงุฎุชุจุฑ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ
- โ ุชุณุฌูู ุฏุฎูู ูู ุงููุธุงู ุงูุฑุฆูุณู
- โ ุชุณุฌูู ุฏุฎูู ูู ุจูุงุจุฉ ุงูุนููุงุก
- โ ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ
- โ ุชุณุฌูู ุฏุฎูู/ุฎุฑูุฌ
- โ ุนุฑุถ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ

---

## ูู ุญุงูุฉ ูุฌูุฏ ูุดููุฉ - Rollback ๐

### ุฅุฐุง ุญุฏุซ ุฎุทุฃุ ุงุณุชุนุฏ ุงููุณุฎุฉ ุงูุณุงุจูุฉ:

#### 1. ุฅููุงู ุงูุชุทุจููุงุช
```bash
pm2 stop xgym-system
pm2 stop xgym-client
```

#### 2. ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
```bash
cd "C:\Users\amran\Desktop\x gym\prisma"

# ุดูู ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
dir gym-backup-*.db

# ุงุณุชุนุฏูุง (ุบูุฑ ุงูุชุงุฑูุฎ ูููุณุฎุฉ ุงููู ุนุงูุฒูุง)
copy gym-backup-20260125.db gym.db
```

#### 3. ุงุณุชุนุงุฏุฉ ุงูููุฏ (ุฅุฐุง ููุช ุชุณุชุฎุฏู Git)
```bash
cd "C:\Users\amran\Desktop\x gym"
git log --oneline -5
git reset --hard [commit-id]
```

#### 4. ุฅุนุงุฏุฉ ุงูุจูุงุก ูุงูุชุดุบูู
```bash
# ุจูุงุก ุงููุธุงู ุงูุฑุฆูุณู
cd "C:\Users\amran\Desktop\x gym"
npm run build

# ุจูุงุก ุจูุงุจุฉ ุงูุนููุงุก
cd client-portal
npm run build
cd ..

# ุฅุนุงุฏุฉ ุงูุชุดุบูู
pm2 restart xgym-system
pm2 restart xgym-client
```

---

## ูุตุงุฆุญ ูููุฉ - Important Tips ๐ก

### 1. ุงุนูู ูุณุฎ ุงุญุชูุงุทู ุฏุงุฆูุงู ูุจู ุฃู ุชุญุฏูุซ
```bash
# ูุณุฎ ุงุญุชูุงุทู ูููู ุชููุงุฆู
# ุฃุถู ูู Task Scheduler:
# ุงููุณุงุฑ: C:\Users\amran\Desktop\x gym\backup.bat
# ุงูููุช: ูู ููู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
```

ูุญุชูู `backup.bat`:
```batch
@echo off
set BACKUP_DIR=C:\Backups\xgym
if not exist "%BACKUP_DIR%" mkdir "%BACKUP_DIR%"
copy "C:\Users\amran\Desktop\x gym\prisma\gym.db" "%BACKUP_DIR%\gym-%date:~-4,4%%date:~-10,2%%date:~-7,2%-%time:~0,2%%time:~3,2%.db"
```

### 2. ุฑุงูุจ ุงูู logs
```bash
# ุฑุงูุจ ุงูู logs ูุจุงุดุฑุฉ
pm2 logs

# ุฃู logs ูุญุฏุฏุฉ
pm2 logs xgym-system --lines 100
```

### 3. ุชุญูู ูู ุงูุฐุงูุฑุฉ ูุงูุฃุฏุงุก
```bash
pm2 monit
```

### 4. ูุฅุนุงุฏุฉ ุชุดุบูู ูู ุดูุก
```bash
pm2 restart all
```

### 5. ูุญูุธ ุฅุนุฏุงุฏุงุช PM2 ุจุนุฏ ุงูุชุญุฏูุซ
```bash
pm2 save
```

---

## ุญุงูุงุช ุฎุงุตุฉ - Special Cases ๐ฏ

### ุฅุฐุง ุฃุถูุช Environment Variables ุฌุฏูุฏุฉ:

1. ุนุฏูู ููู `.env`:
```bash
cd "C:\Users\amran\Desktop\x gym"
notepad .env

# ุฃู ููุจูุงุจุฉ
cd client-portal
notepad .env
```

2. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจููุงุช:
```bash
pm2 restart xgym-system
pm2 restart xgym-client
```

### ุฅุฐุง ุบูุฑุช Prisma Schema:

```bash
cd "C:\Users\amran\Desktop\x gym"

# 1. ุฅูุดุงุก migration
npx prisma migrate dev --name description_of_change

# 2. ุฃู ููุฅูุชุงุฌ
npx prisma migrate deploy

# 3. ุชูููุฏ Prisma Client
npx prisma generate
```

### ุฅุฐุง ุบูุฑุช ุงูููุงูุฐ (Ports):

1. ุนุฏูู `package.json` ููุชุทุจูู ุงููุนูู
2. ุนุฏูู Nginx configuration:
```bash
sudo nano /etc/nginx/sites-available/xgym
sudo nginx -t
sudo systemctl restart nginx
```
3. ุฃุนุฏ ุจูุงุก ูุชุดุบูู ุงูุชุทุจูู

---

## Checklist ุงูุณุฑูุน - Quick Checklist โ๏ธ

ูุจู ูู ุชุญุฏูุซ:
- [ ] ูุณุฎ ุงุญุชูุงุทู ูููุงุนุฏุฉ
- [ ] pm2 stop all
- [ ] ูุณุฎ/ุชุญุฏูุซ ุงููููุงุช
- [ ] npm install (ุฅุฐุง ูุฒู)
- [ ] prisma migrate (ุฅุฐุง ูุฒู)
- [ ] npm run build ูููุธุงููู
- [ ] pm2 restart all
- [ ] ุงุฎุชุจุงุฑ ุงููุธุงููู
- [ ] ูุฑุงุฌุนุฉ ุงูู logs

---

## ุฌุฏูู ุงูุชุญุฏูุซุงุช ุงูุฏูุฑูุฉ ๐

| ุงููููุฉ | ุงูุชูุฑุงุฑ | ุงูุฃูุฑ |
|--------|---------|-------|
| ูุณุฎ ุงุญุชูุงุทู ุงููุงุนุฏุฉ | ูููู | `copy prisma\gym.db backup\` |
| ูุฑุงุฌุนุฉ ุงูู Logs | ูููู | `pm2 logs --lines 100` |
| ุชุญุฏูุซ ุงูููุชุจุงุช | ุฃุณุจูุนู | `npm update` |
| ุฅุนุงุฏุฉ ุชุดุบูู PM2 | ุฃุณุจูุนู | `pm2 restart all` |
| ุชุญุฏูุซ Node.js | ุดูุฑู | ุชุญูู ูู ุงูุฅุตุฏุงุฑุงุช ุงูุฌุฏูุฏุฉ |
| ูุณุญ ุงูู Logs ุงููุฏููุฉ | ุดูุฑู | `pm2 flush` |

---

## ุฃูุงูุฑ ุณุฑูุนุฉ ูููุฏุฉ - Quick Commands ๐

```bash
# ุฅููุงู ูุชุดุบูู ุณุฑูุน
pm2 restart all

# ูุดุงูุฏุฉ ุงูุญุงูุฉ
pm2 status

# ูุดุงูุฏุฉ ุงูู logs ูุจุงุดุฑุฉ
pm2 logs

# ูุณุญ ุงูู logs
pm2 flush

# ูุฑุงูุจุฉ ุงูุฃุฏุงุก
pm2 monit

# ูุนูููุงุช ููุตูุฉ ุนู ุชุทุจูู
pm2 info xgym-system

# ุฅุนุงุฏุฉ ุชุดุบูู ุนูุฏ ุชุบููุฑ ุงููููุงุช (Development ููุท)
pm2 restart xgym-system --watch

# ุญูุธ ุงูุฅุนุฏุงุฏุงุช
pm2 save

# ุนุฑุถ ูุงุฆูุฉ ุงูุชุทุจููุงุช ุงููุญููุธุฉ
pm2 list
```

---

**ุชู! ุงูุขู ูุฏูู ุฏููู ูุงูู ูุชุญุฏูุซ ุงููุธุงู ุจุฃูุงู** โ

ูุฃู ูุดููุฉุ ุชุญูู ูู:
1. ุงูู logs: `pm2 logs`
2. ุญุงูุฉ ุงูุชุทุจููุงุช: `pm2 status`
3. ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ูุชููุฑุฉ ููุงุณุชุนุงุฏุฉ
